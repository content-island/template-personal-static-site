---
import Layout from '#layouts/layout.astro';
import Hero from '#components/hero.astro';
import PostPod from '#pods/post/post.pod.astro';
import MiniBioPod from '#pods/mini-bio/mini-bio.pod.astro';
import PopularPostsPod from '#pods/popular-post/popular-post.pod.astro';
import MonthlyRecommendationPod from '#pods/monthly-recommendation/monthly-recommendation.pod.astro';
import { getAllPosts } from '#pods/post-collection/api';

export async function getStaticPaths() {
  const postEntries = await getAllPosts();
  return postEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

// Get other posts for sidebar
const allPosts = await getAllPosts();
const otherPosts = allPosts.slice(0, 5);
---

<Layout title={entry.title}>
  <Hero url={entry.image.url} slot="hero" />

  <PostPod postEntry={entry} />

  <Fragment slot="aside">
    <MiniBioPod type="card" />
    <MonthlyRecommendationPod />
    <PopularPostsPod otherPosts={otherPosts} />
  </Fragment>
</Layout>
