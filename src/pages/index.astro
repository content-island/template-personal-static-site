---
import Layout from '#layouts/layout.astro';
import Hero from '#components/hero.astro';
import MiniBioPod from '#pods/mini-bio/mini-bio.pod.astro';
import ShapeRectangle from '#assets/shapes/rectangle.svg';
import PostCollection from '#pods/post-collection/post-collection.pod.astro';
import NewsletterPod from '#pods/newsletter/newsletter.pod.astro';
import { getAllPosts } from '#pods/post-collection/api';

const allPosts = await getAllPosts();
const sortedPosts = allPosts.sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime());

const otherPosts = allPosts.slice(0, 5);

const homeContent = {
  hero: {
    title: "John's Web Dev Blog",
    description: 'Here you can find various articles on web application development.',
  },
  postCollectionMini: {
    heading: 'Popular posts',
  },
};
---

<Layout title="John's Web Dev Blog">
  <Hero ariaLabelledby="hero-title" slot="hero">
    <div class="flex flex-col gap-2 text-center">
      <h1 class="text-primary-700 text-5xl font-bold" id="hero-title">{homeContent.hero.title}</h1>
      <p class="m-auto max-w-[30ch] text-lg leading-[1.2] tracking-normal">
        {homeContent.hero.description}
      </p>
    </div>
  </Hero>

  <PostCollection posts={sortedPosts} />

  <Fragment slot="aside">
    <MiniBioPod type="card" />
    <NewsletterPod type="mini" />

    <!-- Popular Posts Section -->
    <section
      class="bg-primary-50 dark:bg-primary-100 relative overflow-clip rounded-2xl p-6"
      aria-labelledby="popular-posts-aside-heading"
    >
      <div class="relative z-10 flex flex-col gap-6">
        <h2 class="font-geist font-bold" id="popular-posts-aside-heading">{homeContent.postCollectionMini.heading}</h2>

        <ul class="flex flex-col gap-4" aria-label="List of popular posts">
          {
            otherPosts.map((post: any) => (
              <li>
                <a
                  href={`/posts/${post.slug}`}
                  class="hover:text-primary-600 dark:hover:text-primary-700 leading-[1.3] decoration-[1.4px] underline-offset-2 transition-all hover:underline"
                >
                  {post.title}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
      <!-- Decorative shapes -->
      <div class="text-primary-500/25 absolute right-[-75%] bottom-[-25%] h-[243px] w-[420px]">
        <ShapeRectangle />
      </div>
    </section>
  </Fragment>
</Layout>
